package com.luis.avaliacao.streams

import com.fasterxml.jackson.databind.ObjectMapper
import com.fasterxml.jackson.module.kotlin.KotlinModule
import com.luis.avaliacao.domain.SensorGPS
import com.luis.avaliacao.DTOs.NotificationDTO
import com.luis.avaliacao.DTOs.SensorsRoutesDTO
import com.luis.avaliacao.events.EventArrival
import com.luis.avaliacao.events.EventEndangeredEmployee
import com.luis.avaliacao.repositories.RouteRepository
import com.luis.avaliacao.repositories.SensorGPSRepository
import org.slf4j.LoggerFactory
import org.springframework.scheduling.annotation.Scheduled
import org.springframework.stereotype.Component
import java.lang.Error
import java.util.*

@Component
class CoordinateProcessor(
        private val routeRepository: RouteRepository,
        private val sensorGPSRepository: SensorGPSRepository,
        private val eventArrival: EventArrival,
        private val eventEndangeredEmployee: EventEndangeredEmployee
):Observable() {

    private val log = LoggerFactory.getLogger(CoordinateProcessor::class.java)

    fun receiveCoordinates(sensorGPSFromVehicle: SensorGPS, sensorGPSFromTelephone: SensorGPS){
        this.log.info("---------COORDINATES RECEIVER--------")
        this.log.info("vehicle [{}]",sensorGPSFromVehicle)
        this.log.info("telephone [{}]",sensorGPSFromTelephone)
        this.log.info("")

        if (sensorGPSFromVehicle.coordinate == null || sensorGPSFromTelephone.coordinate == null){
            throw Error("Failed sensors coordinates")
        }

        val routeOptional = this.routeRepository.getRouteBySensorGPSIdFromVehicle(sensorGPSFromVehicle.id)

        if (routeOptional.isPresent){

            val route = routeOptional.get()

            val lastCoordinateSensorGPSVehicle = if (route.vehicle.sensorGPS.coordinate != null){
                val lastCoordinate = route.vehicle.sensorGPS.coordinate
                val updateCoordinate = route.vehicle.sensorGPS.coordinate.copy(latitude = sensorGPSFromVehicle.coordinate.latitude,longitude = sensorGPSFromVehicle.coordinate.longitude,datePing = sensorGPSFromVehicle.coordinate.datePing)
                val updateSensorGPSFromVehicle = route.vehicle.sensorGPS.copy(coordinate = updateCoordinate)
                this.sensorGPSRepository.save(updateSensorGPSFromVehicle)
                lastCoordinate
            }else{
                val lastCoordinate = sensorGPSFromVehicle.coordinate
                this.sensorGPSRepository.save(sensorGPSFromVehicle)
                lastCoordinate
            }

            val lastCoordinateSensorGPSTelephone = if (route.employee.telephone.sensorGPS.coordinate != null){
                val lastCoordinate = route.employee.telephone.sensorGPS.coordinate
                val updateCoordinate = route.employee.telephone.sensorGPS.coordinate.copy(latitude = sensorGPSFromTelephone.coordinate.latitude,longitude = sensorGPSFromTelephone.coordinate.longitude,datePing = sensorGPSFromTelephone.coordinate.datePing)
                val updateSensorGPSFromTelephone = route.employee.telephone.sensorGPS.copy(coordinate = updateCoordinate)
                this.sensorGPSRepository.save(updateSensorGPSFromTelephone)
                lastCoordinate
            }else{
                val lastCoordinate = sensorGPSFromTelephone.coordinate
                this.sensorGPSRepository.save(sensorGPSFromTelephone)
                lastCoordinate
            }
            setChanged()
            notifyObservers(NotificationDTO(route.id, lastCoordinateSensorGPSVehicle,sensorGPSFromVehicle.coordinate,lastCoordinateSensorGPSTelephone, sensorGPSFromTelephone.coordinate))
        }

    }

    @Scheduled(fixedDelay = 100000, initialDelay = 10000)
    fun consumeCoordinates(){
        val mapper = ObjectMapper().registerModule(KotlinModule())

        val jsonContentSensorsGPSRoute = "[{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110911,\"longitude\":-44.324189,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110911,\"longitude\":-44.324189,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110843,\"longitude\":-44.324396,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110843,\"longitude\":-44.324396,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110875,\"longitude\":-44.324546,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110875,\"longitude\":-44.324546,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110875,\"longitude\":-44.324546,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110875,\"longitude\":-44.324546,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110821,\"longitude\":-44.324771,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110821,\"longitude\":-44.324771,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110832,\"longitude\":-44.325554,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110832,\"longitude\":-44.325554,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110517,\"longitude\":-44.330221,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110517,\"longitude\":-44.330221,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110517,\"longitude\":-44.330221,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110517,\"longitude\":-44.330221,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110517,\"longitude\":-44.330221,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110517,\"longitude\":-44.330221,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110094,\"longitude\":-44.327163,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110094,\"longitude\":-44.327163,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110094,\"longitude\":-44.327163,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110094,\"longitude\":-44.327163,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.110094,\"longitude\":-44.327163,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.110094,\"longitude\":-44.327163,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}},{\"coordinateSensorGPSVehicle\":{\"id\":1,\"coordinate\":{\"id\":1,\"latitude\":-3.109405,\"longitude\":-44.329807,\"datePing\":1608493803}},\"coordinateSensorGPSTelephone\":{\"id\":2,\"coordinate\":{\"id\":2,\"latitude\":-3.108506,\"longitude\":-44.330329,\"datePing\":1608493803}}}]"
        val listCoordinatesSensorsRoutes = mapper.readValue(jsonContentSensorsGPSRoute, Array<SensorsRoutesDTO>::class.java).asList()

        this.addObserver(eventArrival)
        this.addObserver(eventEndangeredEmployee)

        listCoordinatesSensorsRoutes.forEach { sensorsRoute ->
            if (sensorsRoute.coordinateSensorGPSVehicle.coordinate != null && sensorsRoute.coordinateSensorGPSTelephone.coordinate != null){
                val updateDatePingCoordinateVehicle = sensorsRoute.coordinateSensorGPSVehicle.coordinate.copy(datePing = Date())
                val updateDatePingCoordinateTelephone = sensorsRoute.coordinateSensorGPSTelephone.coordinate.copy(datePing = Date())

                val updateSensorGPSVehicle =  sensorsRoute.coordinateSensorGPSVehicle.copy(coordinate = updateDatePingCoordinateVehicle)
                val updateSensorGPSTelephone =  sensorsRoute.coordinateSensorGPSTelephone.copy(coordinate = updateDatePingCoordinateTelephone)

                Thread.sleep(1000)
                this.receiveCoordinates(updateSensorGPSVehicle,updateSensorGPSTelephone)
            }
        }
    }
}